"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,e=require("rxjs"),r=require("rxjs/operators"),n=require("ts-action"),o=require("reselect");
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function i(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function a(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t}(t=exports.FlattenOperator||(exports.FlattenOperator={})).switchMap="switchMap",t.mergeMap="mergeMap",t.concatMap="concatMap",t.exhaustMap="exhaustMap";var u=function(t){return null!==t&&"object"==typeof t},c=e.pipe(r.catchError((function(t){return e.of(t)}))),p=function(t){return t.pipe(c)},f=function(t){return e.isObservable(t)?t:t instanceof Promise?e.from(t):e.of(t)};function s(t){var e=i(t,3),n=e[0],o=e[1],u=e[2];return r.scan((function(t,e){return u.length>0?u.reduce((function(t,e){return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return t(e.apply(void 0,a(r)))}}))(o)(t,e):o(t,e)}),n)}var l={switchMap:r.switchMap,mergeMap:r.mergeMap,concatMap:r.concatMap,exhaustMap:r.exhaustMap};
/**
 * Reactive state container based on RxJS (https://rxjs.dev/)
 *
 * @class AsyncStore<State, ActionsUnion>
 *
 * @type State - application state interface
 * @type ActionsUnion - type union of all the actions
 */
var d=
/**
     * Default configuration
     *
     * @param {Object} config
     *  {
     *     reducer$: of(reducer({})),
     *     actionStream$: EMPTY, // if not defined, no actions will be dispatched in the store
     *     initialState$: of({}),
     *     middleware$: of([]),
     *     destroy$: NEVER // if not defined, the state subscription will live forever
     *  }
     *
     * @param {Object} options
     *  {
     *     actionFop: FlattenOps.concatMap, // Flatten operator for actions's stream.
     *     stateFop: FlattenOps.switchMap // Flatten operator for state's stream.
     *     windowTime: undefined //Maximum time length of the replay buffer in milliseconds.
     *     bufferSize: 1 //Maximum element count of the replay buffer.
     *  }
     */
function(t,o){this.config=t,this.options=o;var i=function(t,o){void 0===t&&(t={}),void 0===o&&(o={});var i=t&&t.reducer$&&t.reducer$.pipe(c)||e.of(n.reducer({})),a=new e.Subject,s=(t&&t.initialState$&&t.initialState$.pipe(c)||e.of({})).pipe(r.share()),d=t&&t.middleware$&&t.middleware$.pipe(c)||e.of([]),h=t&&t.destroy$&&t.destroy$.pipe(c)||e.NEVER,m=l[o&&o.actionFlatOp||exports.FlattenOperator.concatMap],x=l[o&&o.stateFlatOp||exports.FlattenOperator.switchMap],$=o&&o.bufferSize||1,S=o&&o.windowTime;return{reducer$:i,actions$:a,actionStream$:function(n){return(t&&t.actionStream$&&t.actionStream$.pipe(c)||e.EMPTY).pipe(r.filter(u),r.map(f),m(p),r.tap(a),n,r.map(f))},initialState$:s,middleware$:d,destroy$:h,flattenState$:function(t){return t.pipe(x(p),r.map(f),x(p))},shareReplayConfig:{refCount:!1,bufferSize:$,windowTime:S}}}(this.config,this.options),a=i.reducer$,d=i.actions$,h=i.actionStream$,m=i.middleware$,x=i.initialState$,$=i.destroy$,S=i.flattenState$,v=i.shareReplayConfig;this.state$=e.combineLatest(x,a,m).pipe(r.map(s),r.concatMap(h),r.startWith(x),S,r.takeUntil($),r.shareReplay(v)),this.state$.subscribe(),this.actions$=d.pipe(r.shareReplay(v))};Object.keys(n).forEach((function(t){"default"!==t&&Object.defineProperty(exports,t,{enumerable:!0,get:function(){return n[t]}})})),Object.keys(o).forEach((function(t){"default"!==t&&Object.defineProperty(exports,t,{enumerable:!0,get:function(){return o[t]}})})),exports.Store=d,exports.catchErr=c,exports.createStore=function(t,e){return void 0===t&&(t={}),void 0===e&&(e={}),new d(t,e)}
/**
 *
 * @param mapFn - a function to map a state with
 * @returns {MiddlewareFn} MiddlewareFn<State>
 *
 * PS - previous state
 * NS - next state
 */,exports.filterA=function(t){return function(e){return function(r,n){return t(n)?e(r,n):r}}},exports.filterNS=function(t){return function(e){return function(r,n){var o=e(r,n);return t(o)?o:r}}},exports.filterPS=function(t){return function(e){return function(r,n){return t(r)?e(r,n):r}}},exports.mapA=function(t){return function(e){return function(r,n){return e(r,t(n))}}},exports.mapNS=function(t){return function(e){return function(r,n){return t(e(r,n))}}},exports.mapPS=function(t){return function(e){return function(r,n){return e(t(r),n)}}},exports.mapToObservable=f,exports.reduceA=function(t){return function(e){return function(r,n){return e(r,t(r,n))}}},exports.reduceNS=function(t){return function(e){return function(r,n){return t(e(r,n),n)}}},exports.reducePS=function(t){return function(e){return function(r,n){return e(t(r,n),n)}}};
