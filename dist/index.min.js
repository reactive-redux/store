"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,e=require("rxjs/operators"),r=require("rxjs"),n=require("ts-action");
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function o(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)u.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return u}function i(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}function u(t,e){return t===e}function a(t,e,r){for(var n=0;n<t.length;n++)if(!r(t[n],e[n]))return!0;return!1}function c(t,e,r){void 0===e&&(e=u),void 0===r&&(r=u);var n=null,o=null;
// tslint:disable-next-line:no-any anything could be the result.
return{memoized:
// tslint:disable-next-line:no-any anything could be the result.
function(){if(!n)return o=t.apply(null,arguments),n=arguments,o;if(!a(arguments,n,e))return o;n=arguments;var i=t.apply(null,arguments);return r(o,i)?o:(o=i,i)},reset:function(){n=null,o=null}}}function p(t,e,r,n){if(void 0===r){var o=e.map((function(e){return e(t)}));return n.memoized.apply(null,o)}var u=e.map((function(e){return e(t,r)}));return n.memoized.apply(null,i(u,[r]))}function f(t,e){return void 0===e&&(e={stateFn:p}),function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var u=r;if(Array.isArray(u[0])){var a=o(u),p=a[0],f=a.slice(1);u=i(p,f)}var l=u.slice(0,u.length-1),s=u[u.length-1],d=l.filter((function(t){return t.release&&"function"==typeof t.release})),h=t((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return s.apply(null,t)})),m=c((function(t,r){
// createSelector works directly on state
// e.g. createSelector((state, props) => ...)
return 0===l.length&&void 0!==r?s.apply(null,[t,r]):e.stateFn.apply(null,[t,l,r,h])}));function v(){m.reset(),h.reset(),d.forEach((function(t){return t.release()}))}return Object.assign(m.memoized,{release:v,projector:h.memoized})}}(t=exports.FlattenOperator||(exports.FlattenOperator={})).switchMap="switchMap",t.mergeMap="mergeMap",t.concatMap="concatMap",t.exhaustMap="exhaustMap";var l=function(t){return null!==t&&"object"==typeof t},s=r.pipe(e.catchError((function(t){return r.of(t)}))),d=function(t){return t.pipe(s)},h=function(t){return r.isObservable(t)?t:t instanceof Promise?r.from(t):r.of(t)};function m(t){var r=o(t,3),n=r[0],u=r[1],a=r[2];return e.scan((function(t,e){return a.length>0?a.reduce((function(t,e){return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return t(e.apply(void 0,i(r)))}}))(u)(t,e):u(t,e)}),n)}var v={switchMap:e.switchMap,mergeMap:e.mergeMap,concatMap:e.concatMap,exhaustMap:e.exhaustMap};
/**
 * Reactive state container based on RxJS (https://rxjs.dev/)
 *
 * @class AsyncStore<State, ActionsUnion>
 *
 * @type State - application state interface
 * @type ActionsUnion - type union of all the actions
 */
var y=
/**
     * Default configuration
     *
     * @param {Object} config
     *  {
     *     reducer$: of(reducer({})),
     *     actionStream$: EMPTY, // if not defined, no actions will be dispatched in the store
     *     initialState$: of({}),
     *     middleware$: of([]),
     *     destroy$: NEVER // if not defined, the state subscription will live forever
     *  }
     *
     * @param {Object} options
     *  {
     *     actionFop: FlattenOps.concatMap, // Flatten operator for actions's stream.
     *     stateFop: FlattenOps.switchMap // Flatten operator for state's stream.
     *     windowTime: undefined //Maximum time length of the replay buffer in milliseconds.
     *     bufferSize: 1 //Maximum element count of the replay buffer.
     *  }
     */
function(t,o){this.config=t,this.options=o;var i=function(t,o){void 0===t&&(t={}),void 0===o&&(o={});var i=t&&t.reducer$&&t.reducer$.pipe(s)||r.of(n.reducer({})),u=new r.Subject,a=(t&&t.initialState$&&t.initialState$.pipe(s)||r.of({})).pipe(e.share()),c=t&&t.middleware$&&t.middleware$.pipe(s)||r.of([]),p=t&&t.destroy$&&t.destroy$.pipe(s)||r.NEVER,f=v[o&&o.actionFlatOp||exports.FlattenOperator.concatMap],m=v[o&&o.stateFlatOp||exports.FlattenOperator.switchMap],y=o&&o.bufferSize||1,x=o&&o.windowTime;return{reducer$:i,actions$:u,actionStream$:function(n){return(t&&t.actionStream$&&t.actionStream$.pipe(s)||r.EMPTY).pipe(e.filter(l),e.map(h),f(d),e.tap(u),n,e.map(h))},initialState$:a,middleware$:c,destroy$:p,flattenState$:function(t){return t.pipe(m(d),e.map(h),m(d))},shareReplayConfig:{refCount:!1,bufferSize:y,windowTime:x}}}(this.config,this.options),u=i.reducer$,a=i.actions$,c=i.actionStream$,p=i.middleware$,f=i.initialState$,y=i.destroy$,x=i.flattenState$,$=i.shareReplayConfig;this.state$=r.combineLatest(f,u,p).pipe(e.map(m),e.concatMap(c),e.startWith(f),x,e.takeUntil(y),e.shareReplay($)),this.state$.subscribe(),this.actions$=a.pipe(e.shareReplay($))};
/**
 *
 * @param mapFn - a function to map a state with
 * @returns {MiddlewareFn} MiddlewareFn<State>
 *
 * PS - previous state
 * NS - next state
 */Object.keys(n).forEach((function(t){"default"!==t&&Object.defineProperty(exports,t,{enumerable:!0,get:function(){return n[t]}})})),exports.Store=y,exports.catchErr=s,exports.createSelector=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return f(c).apply(void 0,i(t))},exports.filterA=function(t){return function(e){return function(r,n){return t(n)?e(r,n):r}}},exports.filterNS=function(t){return function(e){return function(r,n){var o=e(r,n);return t(o)?o:r}}},exports.filterPS=function(t){return function(e){return function(r,n){return t(r)?e(r,n):r}}},exports.mapA=function(t){return function(e){return function(r,n){return e(r,t(n))}}},exports.mapNS=function(t){return function(e){return function(r,n){return t(e(r,n))}}},exports.mapPS=function(t){return function(e){return function(r,n){return e(t(r),n)}}},exports.mapToObservable=h,exports.reduceA=function(t){return function(e){return function(r,n){return e(r,t(r,n))}}},exports.reduceNS=function(t){return function(e){return function(r,n){return t(e(r,n),n)}}},exports.reducePS=function(t){return function(e){return function(r,n){return e(t(r,n),n)}}},exports.select=function(t,r){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return function(o){var u;if("string"==typeof t){var a=i([r],n).filter(Boolean);u=o.pipe(e.pluck.apply(void 0,i([t],a)))}else{if("function"!=typeof t)throw new TypeError("Unexpected type '"+typeof t+"' in select operator, expected 'string' or 'function'");u=o.pipe(e.map((function(e){return t(e,r)})))}return u.pipe(e.distinctUntilChanged())}};
